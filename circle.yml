## Customize the test machine
machine:
  python:
    version: 2.7.6
  services:
    - docker

      ## Cache base docker image (python:2.7) to speed up rebuilding
dependencies:
  cache_directories:
    - "~/docker"

  override:
    - mkdir -p ~/docker
    - if [[ -e ~/docker/base.tar ]]; then docker load -i ~/docker/base.tar; else docker pull python:2.7 && docker save python:2.7 > ~/docker/base.tar; fi

database:
  post:
    - psql -c 'CREATE DATABASE avipost_ci;'
    - psql -c "CREATE EXTENSION postgis;" -d avipost_ci

## Customize test commands
test:
  pre:
    - docker build -t avipost .
    - docker run --net="host" avipost ls
    - docker run --net="host" avipost python avipost/manage.py migrate --settings=avipost.settings.ci
    # - docker run --name=api -p 3001:80 -d avipost
  override:
    - docker run python avipost/manage.py test
