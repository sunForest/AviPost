## Customize the test machine
machine:
  python:
    version: 2.7.6
  services:
    - docker
  environment:
    COVERALLS_REPO_TOKEN: rE9UQYri7oXINFzS6eJ3a0ssUJqLL8bg0

dependencies:
  pre:
    - pip install -r requirements/ci.txt

database:
  post:
    - psql -c 'CREATE DATABASE avipost_ci;'
    - psql -c "CREATE EXTENSION postgis;" -d avipost_ci

## Customize test commands
test:
  pre:
    # set up test database
    - python avipost/manage.py migrate --settings=avipost.settings.ci
    # e2e test
    - docker build -t avipost -p 5432:5432 .
    # - docker run --name=api -p 3001:80 -d avipost
  override:
    - coverage run --source='.' avipost/manage.py test --settings=avipost.settings.ci
  post:
    - coverage html -d $CIRCLE_ARTIFACTS
    - coveralls
