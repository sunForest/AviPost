## Customize the test machine
machine:
  python:
    version: 2.7.6
  services:
    - docker

database:
  post:
    - psql -c 'CREATE DATABASE avipost_ci;'
    - psql -c "CREATE EXTENSION postgis;" -d avipost_ci

## Customize test commands
test:
  pre:
    - docker build -t avipost .
    - docker run --net="host" avipost python avipost/manage.py migrate --settings=avipost.settings.ci
    # - docker run --name=api -p 3001:80 -d avipost
  override:
    - docker run --net="host" avipost coverage run --source='.' avipost/manage.py test --settings=avipost.settings.ci
  post:
    - docker run --net="host" avipost coveralls
